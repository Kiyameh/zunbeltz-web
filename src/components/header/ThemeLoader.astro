---
/* 
 !important: Este archivo se encarga de elegir el tema seg√∫n las preferencias del usuario y el sistema. 
 Debe importarse en el <head> del layout principal para evitar FOUC (Flash of Unstyled Content).
 */

import { DEFAULT_THEME } from "@/utils/theme-utils";
---

<script is:inline define:vars={{ DEFAULT_THEME }}>
  (() => {
    const THEME_STORAGE_KEY = "theme";
    const THEME_ATTRIBUTE = "data-theme";

    const getStoredTheme = () => {
      const stored = localStorage.getItem(THEME_STORAGE_KEY);
      if (stored === "light" || stored === "dark") {
        return stored;
      }
      return null;
    };

    const getSystemThemePreference = () => {
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)",
      ).matches;
      if (prefersDark) {
        return "dark";
      }
      // Si no prefiere dark, usar el tema por defecto
      return DEFAULT_THEME;
    };

    const resolveTheme = () => {
      const storedTheme = getStoredTheme();
      if (storedTheme) {
        return storedTheme;
      }
      return getSystemThemePreference();
    };

    const theme = resolveTheme();
    document.documentElement.setAttribute(THEME_ATTRIBUTE, theme);
  })();
</script>
