---
/* 
TODO: Revisar componente cuando haya mas de 10 post.  

*/

interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl?: string;
}

const { currentPage, totalPages, baseUrl = "/" } = Astro.props;

// Validar que currentPage esté en el rango válido
const validCurrentPage = Math.max(1, Math.min(currentPage, totalPages));

// Generar array de números de página a mostrar
const getPageNumbers = () => {
  const pages: (number | string)[] = [];
  const maxVisible = 5; // Máximo de números de página visibles

  if (totalPages <= maxVisible) {
    // Si hay pocas páginas, mostrar todas
    for (let i = 1; i <= totalPages; i++) {
      pages.push(i);
    }
  } else {
    // Siempre mostrar primera página
    pages.push(1);

    if (validCurrentPage > 3) {
      pages.push("...");
    }

    // Páginas alrededor de la actual
    const start = Math.max(2, validCurrentPage - 1);
    const end = Math.min(totalPages - 1, validCurrentPage + 1);

    for (let i = start; i <= end; i++) {
      pages.push(i);
    }

    if (validCurrentPage < totalPages - 2) {
      pages.push("...");
    }

    // Siempre mostrar última página
    if (totalPages > 1) {
      pages.push(totalPages);
    }
  }

  return pages;
};

const pageNumbers = getPageNumbers();

const buildUrl = (page: number) => {
  if (page === 1) {
    return baseUrl;
  }
  const separator = baseUrl.includes("?") ? "&" : "?";
  return `${baseUrl}${separator}page=${page}`;
};
---

<nav class="pagination" aria-label="Paginación">
  <!-- Botón anterior -->
  {
    validCurrentPage > 1 ? (
      <a
        href={buildUrl(validCurrentPage - 1)}
        class="button secondary"
        aria-label="Página anterior"
      >
        ← Anterior
      </a>
    ) : (
      <span class="button secondary disabled" aria-disabled="true">
        ← Anterior
      </span>
    )
  }

  <!-- Números de página -->
  <div class="pagination-numbers">
    {
      pageNumbers.map((page) =>
        typeof page === "number" ? (
          <a
            href={buildUrl(page)}
            class:list={[
              "icon-button",
              "secondary",
              "rounded",
              { active: page === validCurrentPage },
            ]}
            aria-label={`Página ${page}`}
            aria-current={page === validCurrentPage ? "page" : undefined}
          >
            <span class="number-container">{page}</span>
          </a>
        ) : (
          <span class="icon-button secondary" aria-hidden="true">
            <span class="number-container">{page}</span>
          </span>
        ),
      )
    }
  </div>

  <!-- Botón siguiente -->
  {
    validCurrentPage < totalPages ? (
      <a
        href={buildUrl(validCurrentPage + 1)}
        class="button secondary"
        aria-label="Página siguiente"
      >
        Siguiente →
      </a>
    ) : (
      <span class="button secondary disabled" aria-disabled="true">
        Siguiente →
      </span>
    )
  }
</nav>

<style>
  .pagination {
    padding: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
  }

  .pagination-numbers {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .number-container {
    width: 24px;
    height: 24px;
  }
</style>
