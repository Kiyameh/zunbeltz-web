---
import { getCollection, getEntry } from "astro:content";
import type { GetStaticPaths } from "astro";
import { Image } from "astro:assets";
import HtmlLayout from "@/layouts/HtmlLayout.astro";
import HeaderLayout from "@/layouts/HeaderLayout.astro";
import Breadcrumb from "@/components/ui/Breadcrumb.astro";
import RecentPosts from "@/components/blog/RecentPosts.astro";
import PostHeader from "@/components/blog/PostHeader.astro";
import BlogCategories from "@/components/blog/BlogCategories.astro";
import AuthorProfile from "@/components/blog/AuthorProfile.astro";

export const getStaticPaths = (async () => {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await post.render();
const author = await getEntry(post.data.author);
---

<HtmlLayout pageTitle={post.data.title} pageDescription={post.data.description}>
  <HeaderLayout />

  <!-- Main layout -->
  <main class="main-container">
    <Breadcrumb />

    <!-- ! Indexado en pagefind -->
    <article class="article" data-pagefind-body>
      <!-- ! Metadatos para la indexaciÃ³n en pagefind -->
      <div class="pagefind-metadata">
        <span data-pagefind-filter="Tipo">Entrada de blog</span>
        <span data-pagefind-filter="Autor">{author.data.name}</span>
        <span data-pagefind-meta="title">{post.data.title}</span>
        <span data-pagefind-meta="image">{post.data.heroImage.src}</span>
        <span data-pagefind-meta="image_alt">{post.data.title}</span>
      </div>

      <div class="hero-image">
        <Image
          src={post.data.heroImage}
          alt={post.data.title}
          width={1200}
          height={400}
          quality={80}
        />
      </div>

      <PostHeader post={post} data-pagefind-ignore />

      <div class="post-content">
        <Content />
      </div>

      <AuthorProfile author={author} data-pagefind-ignore />
    </article>
  </main>

  <!-- Right layout-->
  <div class="right-container">
    <BlogCategories />
  </div>

  <!-- Left layout -->
  <div class="left-container">
    <RecentPosts />
  </div>
</HtmlLayout>

<style>
  /* Layout */
  .main-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 3rem 0.5rem 2rem 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .article {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .right-container {
    position: fixed;
    top: 4rem;
    right: 0;
    height: 100vh;
    overflow-y: auto;
    padding: 2rem;
  }

  .left-container {
    position: fixed;
    top: 4rem;
    left: 0;
    height: 100vh;
    overflow-y: auto;
    padding: 2rem;
  }

  @media (max-width: 1520px) {
    .right-container,
    .left-container {
      display: none;
    }
  }

  /* Main content */
  .pagefind-metadata {
    display: none;
  }

  .hero-image {
    width: 100%;
    aspect-ratio: 16 / 5;
    overflow: hidden;
    background-color: var(--color-surface-300);
    border-radius: var(--radius-3xl);
    transition: scale 0.3s ease;
  }
  .hero-image:hover {
    scale: 1.02;
  }

  .hero-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .post-content {
    font-family: var(--font-paragraph);
    color: var(--color-content-300);
    line-height: 1.8;
    padding-bottom: 2rem;
    border-bottom: 2px solid var(--color-border-100);
  }

  /* Estilos para el contenido MDX */
  .post-content :global(h2) {
    font-family: var(--font-title);
    font-size: 1.5rem;
    margin-top: 2rem;
    margin-bottom: 1rem;
    color: var(--color-content-400);
  }

  .post-content :global(h3) {
    font-family: var(--font-title);
    font-size: 1.25rem;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    color: var(--color-content-400);
  }

  .post-content :global(p) {
    margin-bottom: 1rem;
  }

  .post-content :global(ul),
  .post-content :global(ol) {
    margin-bottom: 1rem;
    padding-left: 2rem;
  }

  .post-content :global(ul) {
    list-style: disc;
  }

  .post-content :global(ol) {
    list-style: decimal;
  }

  .post-content :global(li) {
    margin-bottom: 0.5rem;
  }

  .post-content :global(strong) {
    font-weight: 600;
    color: var(--color-content-400);
  }

  .post-content :global(code) {
    background-color: var(--color-surface-200);
    padding: 0.2rem 0.4rem;
    border-radius: var(--radius-sm);
    font-size: 0.9em;
  }

  .post-content :global(pre) {
    background-color: var(--color-surface-200);
    padding: 1rem;
    border-radius: var(--radius-md);
    overflow-x: auto;
    margin-bottom: 1rem;
  }

  .post-content :global(pre code) {
    background-color: transparent;
    padding: 0;
  }

  .post-content :global(img) {
    border-radius: var(--radius-lg);
    margin: 2rem 0;
  }
</style>
