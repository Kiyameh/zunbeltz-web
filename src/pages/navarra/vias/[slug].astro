---
import { getCollection, type CollectionEntry } from "astro:content";
import HtmlLayout from "@/layouts/HtmlLayout.astro";
import type { MetaInfo } from "@/components/SEO/MetaInfo";
import ClimbingRouteProperties from "@/components/navarra/climbing/ClimbingRouteProperties.astro";
import ImageGallery from "@/components/navarra/shared/ImageGallery.astro";
import Breadcrumb from "@/components/ui/Breadcrumb.astro";
import HeroSection from "@/components/navarra/shared/HeroSection.astro";

export async function getStaticPaths() {
  const climbingRoutes = await getCollection("climbingRoutes");
  return climbingRoutes.map((route) => ({
    params: { slug: route.slug },
    props: { route },
  }));
}

interface Props {
  route: CollectionEntry<"climbingRoutes">;
}

const { route } = Astro.props;
const { Content: RouteContent } = await route.render();

const meta: MetaInfo = {
  pageTitle: `${route.data.name} | Vías de Escalada | Zunbeltz`,
  pageDescription:
    route.data.description || `Vía de escalada ${route.data.name}`,
  pageTags: ["Escalada", "Vía", "Navarra"],
  pageUrl: `https://zunbeltz.org/navarra/vias/${route.slug}`,
};
---

<HtmlLayout metaInfo={meta}>
  <main>
    <article>
      <HeroSection
        title={route.data.name}
        description={route.data.description}
        photo={route.data.mainPhoto}
      />

      <div class="container">
        <Breadcrumb />
      </div>

      <div class="container">
        <div class="grid">
          <div class="main-column">
            <ClimbingRouteProperties route={route.data} />
            <section class="markdown-content">
              <RouteContent />
            </section>
          </div>

          <aside class="side-column">
            <!-- Aquí podrían ir cards adicionales si las hay -->
          </aside>
        </div>
      </div>

      <ImageGallery photos={route.data.additionalPhotos || []} />
    </article>
  </main>
</HtmlLayout>

<style>
  .container {
    max-width: 1300px;
    margin: 0 auto;
    padding: 0 1.5rem 3rem 1.5rem;
  }

  .grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 3rem;
  }

  .main-column {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .side-column {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .markdown-content {
    font-family: var(--font-paragraph);
    color: var(--color-content-300);
    line-height: 1.7;
  }

  /* Responsive */
  @media (max-width: 968px) {
    .grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .side-column {
      order: -1;
    }
  }
</style>
