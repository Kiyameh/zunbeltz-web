---
import { getCollection, type CollectionEntry } from "astro:content";
import HtmlLayout from "@/layouts/HtmlLayout.astro";
import type { MetaInfo } from "@/components/SEO/MetaInfo";
import BoulderProblemProperties from "@/components/navarra/climbing/BoulderProblemProperties.astro";
import ImageGallery from "@/components/navarra/shared/ImageGallery.astro";
import Breadcrumb from "@/components/ui/Breadcrumb.astro";
import HeroSection from "@/components/navarra/shared/HeroSection.astro";

export async function getStaticPaths() {
  const boulderProblems = await getCollection("boulderProblems");
  return boulderProblems.map((problem) => ({
    params: { slug: problem.slug },
    props: { problem },
  }));
}

interface Props {
  problem: CollectionEntry<"boulderProblems">;
}

const { problem } = Astro.props;
const { Content: ProblemContent } = await problem.render();

const meta: MetaInfo = {
  pageTitle: `${problem.data.name} | Problemas de Boulder | Zunbeltz`,
  pageDescription:
    problem.data.description || `Problema de boulder ${problem.data.name}`,
  pageTags: ["Boulder", "Bloque", "Navarra"],
  pageUrl: `https://zunbeltz.org/navarra/bloques/${problem.slug}`,
};
---

<HtmlLayout metaInfo={meta}>
  <main>
    <article>
      <HeroSection
        title={problem.data.name}
        description={problem.data.description}
        photo={problem.data.mainPhoto}
      />

      <div class="container">
        <Breadcrumb />
      </div>

      <div class="container">
        <div class="grid">
          <div class="main-column">
            <BoulderProblemProperties problem={problem.data} />
            <section class="markdown-content">
              <ProblemContent />
            </section>
          </div>

          <aside class="side-column">
            <!-- Aquí podrían ir cards adicionales si las hay -->
          </aside>
        </div>
      </div>

      <ImageGallery photos={problem.data.additionalPhotos || []} />
    </article>
  </main>
</HtmlLayout>

<style>
  .container {
    max-width: 1300px;
    margin: 0 auto;
    padding: 0 1.5rem 3rem 1.5rem;
  }

  .grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 3rem;
  }

  .main-column {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .side-column {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .markdown-content {
    font-family: var(--font-paragraph);
    color: var(--color-content-300);
    line-height: 1.7;
  }

  /* Responsive */
  @media (max-width: 968px) {
    .grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .side-column {
      order: -1;
    }
  }
</style>
